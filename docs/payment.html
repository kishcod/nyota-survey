<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Nyota - Payment</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <main class="container">
    <h1>Pay KSH 50 to activate processing</h1>
    <p>Choose payment method:</p>

    <h3>Manual (Till)</h3>
    <p>Pay to Till: <strong>8160572</strong></p>
    <p>Use Account reference: Your full name</p>

    <hr/>
    <h3>OR Pay using STK Push (M-Pesa)</h3>
    <label>Phone (2547...): <input id="phone" value="2547"/></label><br/>
    <button id="payBtn">Pay KSH 50 via STK Push</button>

    <div id="result"></div>

    <a class="btn" href="wait.html">I have paid â€” Go to waiting page</a>
  </main>

  <script>
    document.getElementById('payBtn').addEventListener('click', async () => {
      const phone = document.getElementById('phone').value.trim();
      const resDiv = document.getElementById('result');
      resDiv.textContent = 'Sending request...';
      try {
        const resp = await fetch('http://localhost:3000/api/initiate-stk', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone: phone, amount: 50 })
        });
        const data = await resp.json();
        if (!resp.ok) throw new Error(JSON.stringify(data));
        resDiv.textContent = 'STK push initiated. Check your phone for the payment prompt.';
      } catch (err) {
        resDiv.textContent = 'Failed to start STK push: ' + err;
      }
    });
  </script>
</body>
</html>
